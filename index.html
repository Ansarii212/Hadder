<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>تقرير الحضور</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      background-color: #f4f4f4;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    #reportTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    #reportTable th, #reportTable td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    #reportTable th {
      background-color: #eee;
    }
    select {
      padding: 10px;
      font-size: 16px;
    }
  </style>
</head>
<body>

<h1>تقرير الحضور</h1>

<label for="dateSelect">اختر التاريخ:</label>
<select id="dateSelect"></select>

<h2 id="attendanceTitle"></h2>
<table id="reportTable">
  <thead>
    <tr>
      <th>اسم الطالب</th>
      <th>الصف</th>
      <th>رقم الجوال</th>
      <th>الوقت</th>
      <th>اليوم</th>
      <th>تاريخ اليوم</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  // إعداد Firebase
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const managerId = "demo123"; // غيّر هذا حسب المستخدم

  const dateSelect = document.getElementById("dateSelect");
  const attendanceTitle = document.getElementById("attendanceTitle");
  const reportTableBody = document.querySelector("#reportTable tbody");

  function loadAvailableDates() {
    const attendanceRef = db.ref(`attendance/${managerId}`);
    attendanceRef.once("value", (snapshot) => {
      const dates = [];
      snapshot.forEach(child => {
        dates.push(child.key);
      });

      dateSelect.innerHTML = "";
      if (dates.length === 0) {
        attendanceTitle.innerText = "لا توجد بيانات حضور متاحة";
        reportTableBody.innerHTML = "<tr><td colspan='6'>لا يوجد حضور مسجل</td></tr>";
        return;
      }

      dates.sort((a, b) => new Date(b) - new Date(a));
      dates.forEach(date => {
        const option = document.createElement("option");
        option.value = date;
        option.textContent = date;
        dateSelect.appendChild(option);
      });

      loadAttendance(dates[0]);
    });
  }

  function loadAttendance(date) {
    const attendanceRef = db.ref(`attendance/${managerId}/${date}`);
    attendanceRef.once("value", (snapshot) => {
      attendanceTitle.innerText = `تقرير الحضور ليوم: ${date}`;
      reportTableBody.innerHTML = "";
      if (!snapshot.exists()) {
        reportTableBody.innerHTML = "<tr><td colspan='6'>لا يوجد حضور مسجل لهذا اليوم</td></tr>";
        return;
      }

      snapshot.forEach(child => {
        const record = child.val();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${record.name}</td>
          <td>${record.grade}</td>
          <td>${record.phone}</td>
          <td>${record.time}</td>
          <td>${record.day}</td>
          <td>${record.date}</td>
        `;
        reportTableBody.appendChild(tr);
      });
    });
  }

  dateSelect.addEventListener("change", () => {
    const selectedDate = dateSelect.value;
    loadAttendance(selectedDate);
  });

  window.onload = () => {
    loadAvailableDates();
  };

  // تسجيل الحضور - كمثال
  function markAttendance(name, grade, phone) {
    const now = new Date();
    const time = now.toLocaleTimeString('ar-EG');
    const date = `${now.getDate().toString().padStart(2, '0')}/${(now.getMonth()+1).toString().padStart(2, '0')}/${now.getFullYear()}`;
    const day = now.toLocaleDateString('ar-EG', { weekday: 'long' });

    const attendanceRef = db.ref(`attendance/${managerId}/${date}`);
    const newRecord = attendanceRef.push();
    newRecord.set({ name, grade, phone, time, date, day });
  }

  // مثال تسجيل حضور (يمكنك حذفه في الإنتاج)
  // markAttendance("محمد علي", "الصف الثاني", "0555555555");
</script>

</body>
</html>
